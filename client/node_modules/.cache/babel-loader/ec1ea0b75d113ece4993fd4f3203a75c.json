{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/Hoby/workspace/voting-dapp/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import VotingContract from\"./contracts/Voting.json\";import getWeb3 from\"./getWeb3\";import\"./App.css\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);function App(){var _getPrototypeOf2;var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(App)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={owner:null,status:0,web3:null,accounts:null,contract:null,proposals:null,winner:null};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,accounts,networkId,deployedNetwork,instance,options,proposalsEvt,owner;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getWeb3();case 3:web3=_context.sent;_context.next=6;return web3.eth.getAccounts();case 6:accounts=_context.sent;_context.next=9;return web3.eth.net.getId();case 9:networkId=_context.sent;deployedNetwork=VotingContract.networks[networkId];instance=new web3.eth.Contract(VotingContract.abi,deployedNetwork&&deployedNetwork.address);// getting the events  \noptions={fromBlock:0,//Number || \"earliest\" || \"pending\" || \"latest\"\ntoBlock:'latest'};_context.next=15;return instance.getPastEvents('ProposalRegistered',options);case 15:proposalsEvt=_context.sent;_context.next=18;return instance.methods.owner().call();case 18:owner=_context.sent;// Set web3, accounts, and contract to the state, and then proceed with an\n// example of interacting with the contract's methods.\n_this.setState({owner:owner,web3:web3,accounts:accounts,contract:instance,proposals:proposalsEvt},_this.runExample);_context.next=26;break;case 22:_context.prev=22;_context.t0=_context[\"catch\"](0);// Catch any errors for any of the above operations.\nalert(\"Failed to load web3, accounts, or contract. Check console for details.\");console.error(_context.t0);case 26:case\"end\":return _context.stop();}}},_callee,null,[[0,22]]);}));_this.runExample=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$state,accounts,contract,status,options,proposalsEvt;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$state=_this.state,accounts=_this$state.accounts,contract=_this$state.contract;_context2.next=3;return contract.methods.workflowStatus().call();case 3:status=_context2.sent;// Update state with the result.\n_this.setState({status:status});if(_this.state.status==5){_this.updateWinner();}// getting the events  \noptions={fromBlock:0,//Number || \"earliest\" || \"pending\" || \"latest\"\ntoBlock:'latest'};_context2.next=9;return contract.getPastEvents('ProposalRegistered',options);case 9:proposalsEvt=_context2.sent;_this.setState({proposals:proposalsEvt});case 11:case\"end\":return _context2.stop();}}},_callee2);}));_this.addVoter=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this$state2,accounts,contract,voterAdress;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state2=_this.state,accounts=_this$state2.accounts,contract=_this$state2.contract;voterAdress=document.getElementById(\"voterAdress\").value;_context3.next=4;return contract.methods.addVoter(voterAdress).send({from:accounts[0]});case 4:document.getElementById(\"voterAdress\").value=\"\";case 5:case\"end\":return _context3.stop();}}},_callee3);}));_this.addProposal=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _this$state3,accounts,contract,proposalDescrition;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$state3=_this.state,accounts=_this$state3.accounts,contract=_this$state3.contract;proposalDescrition=document.getElementById(\"proposalDescrition\").value;_context4.next=4;return contract.methods.addProposal(proposalDescrition).send({from:accounts[0]});case 4:document.getElementById(\"proposalDescrition\").value=\"\";case 5:case\"end\":return _context4.stop();}}},_callee4);}));_this.setVote=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var _this$state4,accounts,contract,proposalId;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this$state4=_this.state,accounts=_this$state4.accounts,contract=_this$state4.contract;//FIXME get the proposal checkedId\nproposalId=1;_context5.next=4;return contract.methods.setVote(proposalId).send({from:accounts[0]});case 4:case\"end\":return _context5.stop();}}},_callee5);}));_this.tallyVotes=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this$state5,accounts,contract;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this$state5=_this.state,accounts=_this$state5.accounts,contract=_this$state5.contract;_context6.next=3;return contract.methods.tallyVotes().send({from:accounts[0]});case 3:_this.updateStatus();_this.updateWinner();case 5:case\"end\":return _context6.stop();}}},_callee6);}));_this.updateStatus=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var contract,status;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:contract=_this.state.contract;_context7.next=3;return contract.methods.workflowStatus().call();case 3:status=_context7.sent;// Update state with the result.\n_this.setState({status:status});case 5:case\"end\":return _context7.stop();}}},_callee7);}));_this.updateWinner=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var contract,winnerId,winnerProposal;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:contract=_this.state.contract;_context8.next=3;return contract.methods.winningProposalID().call();case 3:winnerId=_context8.sent;console.log(winnerId);_context8.prev=5;_context8.next=8;return contract.methods.getOneProposal(winnerId).call();case 8:winnerProposal=_context8.sent;console.log(winnerProposal.description);_this.setState({winner:'#'+winnerId+' '+winnerProposal.description});_context8.next=16;break;case 13:_context8.prev=13;_context8.t0=_context8[\"catch\"](5);_this.setState({winner:''});case 16:case\"end\":return _context8.stop();}}},_callee8,null,[[5,13]]);}));_this.startProposalsRegistering=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var _this$state6,accounts,contract;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_this$state6=_this.state,accounts=_this$state6.accounts,contract=_this$state6.contract;_context9.next=3;return contract.methods.startProposalsRegistering().send({from:accounts[0]});case 3:_this.updateStatus();case 4:case\"end\":return _context9.stop();}}},_callee9);}));_this.endProposalsRegistering=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var _this$state7,accounts,contract;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_this$state7=_this.state,accounts=_this$state7.accounts,contract=_this$state7.contract;_context10.next=3;return contract.methods.endProposalsRegistering().send({from:accounts[0]});case 3:_this.updateStatus();case 4:case\"end\":return _context10.stop();}}},_callee10);}));_this.startVotingSession=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var _this$state8,accounts,contract;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this$state8=_this.state,accounts=_this$state8.accounts,contract=_this$state8.contract;_context11.next=3;return contract.methods.startVotingSession().send({from:accounts[0]});case 3:_this.updateStatus();case 4:case\"end\":return _context11.stop();}}},_callee11);}));_this.endVotingSession=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(){var _this$state9,accounts,contract;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_this$state9=_this.state,accounts=_this$state9.accounts,contract=_this$state9.contract;_context12.next=3;return contract.methods.endVotingSession().send({from:accounts[0]});case 3:_this.updateStatus();case 4:case\"end\":return _context12.stop();}}},_callee12);}));return _this;}_createClass(App,[{key:\"render\",value:function render(){var _this2=this;if(!this.state.web3){return React.createElement(\"div\",null,\"Loading Web3, accounts, and contract...\");}var isOwner=function isOwner(){console.log('owner: '+_this2.state.owner);console.log('account0: '+_this2.state.accounts[0]);return _this2.state.accounts[0]==_this2.state.owner;};var voterRegistration;var endProposalsRegistering;var startVotingSession;var endVotingSession;var tallyVotes;if(isOwner()){voterRegistration=React.createElement(\"div\",null,React.createElement(\"div\",null,React.createElement(\"h3\",null,\"Ajouter un votant\"),\"Entrer l'adresse du votant\",React.createElement(\"input\",{type:\"text\",id:\"voterAdress\"}),React.createElement(\"button\",{onClick:this.addVoter},\"Valider\")),React.createElement(\"br\",null),React.createElement(\"div\",null,React.createElement(\"button\",{onClick:this.startProposalsRegistering},\" D\\xE9marrer l'enregitrement des Propositions\")));endProposalsRegistering=React.createElement(\"div\",null,React.createElement(\"button\",{onClick:this.endProposalsRegistering},\" Arr\\xEAter l'enregitrement des Propositions\"));startVotingSession=React.createElement(\"div\",null,React.createElement(\"button\",{onClick:this.startVotingSession},\" D\\xE9marrer la session de vote\"));endVotingSession=React.createElement(\"div\",null,React.createElement(\"button\",{onClick:this.endVotingSession},\" Arr\\xEAter la session de vote\"));tallyVotes=React.createElement(\"div\",null,React.createElement(\"button\",{onClick:this.tallyVotes},\" Comptabiliser les votes\"));}return React.createElement(\"div\",{className:\"App\"},React.createElement(\"h2\",null,\"Syst\\xE8me de  Vote\"),React.createElement(\"p\",null,\"adresse: \",this.state.accounts[0]),React.createElement(\"div\",null,\"WorkflowStatus: \",this.state.status),voterRegistration,React.createElement(\"div\",null,React.createElement(\"h3\",null,\"Enregistrer une Proposition\"),\"Entrer la Proposition\",React.createElement(\"input\",{type:\"text\",id:\"proposalDescrition\"}),React.createElement(\"button\",{onClick:this.addProposal},\"Valider\")),React.createElement(\"br\",null),endProposalsRegistering,React.createElement(\"br\",null),startVotingSession,React.createElement(\"div\",null,React.createElement(\"h3\",null,\"Voter une proposition\"),this.state.proposals==null?React.createElement(\"p\",null,\"Pas de propositions\"):React.createElement(\"ul\",null,this.state.proposals.map(function(proposal,index){return React.createElement(\"div\",{key:index},React.createElement(\"span\",null,'#'+index+'  '+proposal.returnValues.proposalDescription),React.createElement(\"input\",{value:index,type:\"checkbox\"}));})),React.createElement(\"button\",{onClick:this.setVote},\"Voter\")),React.createElement(\"br\",null),endVotingSession,React.createElement(\"div\",null,React.createElement(\"br\",null),tallyVotes,React.createElement(\"br\",null),React.createElement(\"div\",null,React.createElement(\"span\",null,\"Le gagnant est: \",this.state.winner))),this.state.proposals==null?React.createElement(\"p\",null,\"Pas de propositions\"):React.createElement(\"ul\",null,this.state.proposals.map(function(proposal){return React.createElement(\"li\",null,proposal.returnValues.proposalDescription);})));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/Hoby/workspace/voting-dapp/client/src/App.js"],"names":["React","Component","VotingContract","getWeb3","App","state","owner","status","web3","accounts","contract","proposals","winner","componentDidMount","eth","getAccounts","net","getId","networkId","deployedNetwork","networks","instance","Contract","abi","address","options","fromBlock","toBlock","getPastEvents","proposalsEvt","methods","call","setState","runExample","alert","console","error","workflowStatus","updateWinner","addVoter","voterAdress","document","getElementById","value","send","from","addProposal","proposalDescrition","setVote","proposalId","tallyVotes","updateStatus","winningProposalID","winnerId","log","getOneProposal","winnerProposal","description","startProposalsRegistering","endProposalsRegistering","startVotingSession","endVotingSession","isOwner","voterRegistration","map","proposal","index","returnValues","proposalDescription"],"mappings":"w2BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,cAAP,KAA2B,yBAA3B,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CAEA,MAAO,WAAP,C,GAEMC,CAAAA,G,mXACJC,K,CAAQ,CAAEC,KAAK,CAAE,IAAT,CAAeC,MAAM,CAAE,CAAvB,CAA0BC,IAAI,CAAE,IAAhC,CAAsCC,QAAQ,CAAE,IAAhD,CAAsDC,QAAQ,CAAE,IAAhE,CAAsEC,SAAS,CAAE,IAAjF,CAAuFC,MAAM,CAAE,IAA/F,C,OAGRC,iB,sEAAoB,yPAGGV,CAAAA,OAAO,EAHV,QAGVK,IAHU,qCAMOA,CAAAA,IAAI,CAACM,GAAL,CAASC,WAAT,EANP,QAMVN,QANU,qCASQD,CAAAA,IAAI,CAACM,GAAL,CAASE,GAAT,CAAaC,KAAb,EATR,QASVC,SATU,eAUVC,eAVU,CAUQjB,cAAc,CAACkB,QAAf,CAAwBF,SAAxB,CAVR,CAWVG,QAXU,CAWC,GAAIb,CAAAA,IAAI,CAACM,GAAL,CAASQ,QAAb,CACfpB,cAAc,CAACqB,GADA,CAEfJ,eAAe,EAAIA,eAAe,CAACK,OAFpB,CAXD,CAgBhB;AACIC,OAjBY,CAiBF,CACZC,SAAS,CAAE,CADC,CACmB;AAC/BC,OAAO,CAAE,QAFG,CAjBE,wBAqBWN,CAAAA,QAAQ,CAACO,aAAT,CAAuB,oBAAvB,CAA6CH,OAA7C,CArBX,SAqBVI,YArBU,sCAuBIR,CAAAA,QAAQ,CAACS,OAAT,CAAiBxB,KAAjB,GAAyByB,IAAzB,EAvBJ,SAuBVzB,KAvBU,eAyBhB;AACA;AACA,MAAK0B,QAAL,CAAc,CAAE1B,KAAK,CAALA,KAAF,CAASE,IAAI,CAAJA,IAAT,CAAeC,QAAQ,CAARA,QAAf,CAAyBC,QAAQ,CAAEW,QAAnC,CAA6CV,SAAS,CAAEkB,YAAxD,CAAd,CAAsF,MAAKI,UAA3F,EA3BgB,iFA6BhB;AACAC,KAAK,0EAAL,CAGAC,OAAO,CAACC,KAAR,cAjCgB,qE,SAqCpBH,U,sEAAa,kNACoB,MAAK5B,KADzB,CACHI,QADG,aACHA,QADG,CACOC,QADP,aACOA,QADP,wBAGUA,CAAAA,QAAQ,CAACoB,OAAT,CAAiBO,cAAjB,GAAkCN,IAAlC,EAHV,QAGLxB,MAHK,gBAIX;AACA,MAAKyB,QAAL,CAAc,CAAEzB,MAAM,CAAEA,MAAV,CAAd,EAEA,GAAI,MAAKF,KAAL,CAAWE,MAAX,EAAqB,CAAzB,CAA4B,CAC1B,MAAK+B,YAAL,GACD,CAED;AACIb,OAZO,CAYG,CACZC,SAAS,CAAE,CADC,CACmB;AAC/BC,OAAO,CAAE,QAFG,CAZH,wBAgBgBjB,CAAAA,QAAQ,CAACkB,aAAT,CAAuB,oBAAvB,CAA6CH,OAA7C,CAhBhB,QAgBLI,YAhBK,gBAkBX,MAAKG,QAAL,CAAc,CAAErB,SAAS,CAACkB,YAAZ,CAAd,EAlBW,yD,SAuBbU,Q,sEAAW,oMACqB,MAAKlC,KAD1B,CACDI,QADC,cACDA,QADC,CACSC,QADT,cACSA,QADT,CAEL8B,WAFK,CAESC,QAAQ,CAACC,cAAT,CAAwB,aAAxB,EAAuCC,KAFhD,wBAGHjC,CAAAA,QAAQ,CAACoB,OAAT,CAAiBS,QAAjB,CAA0BC,WAA1B,EAAuCI,IAAvC,CAA4C,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAA5C,CAHG,QAITgC,QAAQ,CAACC,cAAT,CAAwB,aAAxB,EAAuCC,KAAvC,CAA+C,EAA/C,CAJS,wD,SAQXG,W,sEAAc,2MACkB,MAAKzC,KADvB,CACJI,QADI,cACJA,QADI,CACMC,QADN,cACMA,QADN,CAERqC,kBAFQ,CAEaN,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,EAA8CC,KAF3D,wBAGNjC,CAAAA,QAAQ,CAACoB,OAAT,CAAiBgB,WAAjB,CAA6BC,kBAA7B,EAAiDH,IAAjD,CAAsD,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAAtD,CAHM,QAIZgC,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,EAA8CC,KAA9C,CAAsD,EAAtD,CAJY,wD,SAQdK,O,sEAAU,mMACwB,MAAK3C,KAD7B,CACEI,QADF,cACEA,QADF,CACYC,QADZ,cACYA,QADZ,CAEN;AACIuC,UAHE,CAGW,CAHX,wBAIAvC,CAAAA,QAAQ,CAACoB,OAAT,CAAiBkB,OAAjB,CAAyBC,UAAzB,EAAqCL,IAArC,CAA0C,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAA1C,CAJA,yD,SAQVyC,U,sEAAa,wLACqB,MAAK7C,KAD1B,CACDI,QADC,cACDA,QADC,CACSC,QADT,cACSA,QADT,wBAEHA,CAAAA,QAAQ,CAACoB,OAAT,CAAiBoB,UAAjB,GAA8BN,IAA9B,CAAmC,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAAnC,CAFG,QAGT,MAAK0C,YAAL,GACA,MAAKb,YAAL,GAJS,wD,SAOba,Y,sEAAe,4JACLzC,QADK,CACO,MAAKL,KADZ,CACLK,QADK,wBAEQA,CAAAA,QAAQ,CAACoB,OAAT,CAAiBO,cAAjB,GAAkCN,IAAlC,EAFR,QAEPxB,MAFO,gBAGb;AACA,MAAKyB,QAAL,CAAc,CAAEzB,MAAM,CAAEA,MAAV,CAAd,EAJa,wD,SAOf+B,Y,sEAAe,6KACN5B,QADM,CACM,MAAKL,KADX,CACNK,QADM,wBAGYA,CAAAA,QAAQ,CAACoB,OAAT,CAAiBsB,iBAAjB,GAAqCrB,IAArC,EAHZ,QAGLsB,QAHK,gBAIXlB,OAAO,CAACmB,GAAR,CAAYD,QAAZ,EAJW,wCAMoB3C,CAAAA,QAAQ,CAACoB,OAAT,CAAiByB,cAAjB,CAAgCF,QAAhC,EAA0CtB,IAA1C,EANpB,QAMHyB,cANG,gBAOTrB,OAAO,CAACmB,GAAR,CAAYE,cAAc,CAACC,WAA3B,EACA,MAAKzB,QAAL,CAAc,CAAEpB,MAAM,CAAE,IAAMyC,QAAN,CAAiB,GAAjB,CAAuBG,cAAc,CAACC,WAAhD,CAAd,EARS,qFAUT,MAAKzB,QAAL,CAAc,CAAEpB,MAAM,CAAE,EAAV,CAAd,EAVS,uE,SAgBf8C,yB,sEAA4B,wLACI,MAAKrD,KADT,CAClBI,QADkB,cAClBA,QADkB,CACRC,QADQ,cACRA,QADQ,wBAEpBA,CAAAA,QAAQ,CAACoB,OAAT,CAAiB4B,yBAAjB,GAA6Cd,IAA7C,CAAkD,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAAlD,CAFoB,QAG1B,MAAK0C,YAAL,GAH0B,wD,SAM5BQ,uB,sEAA0B,6LACM,MAAKtD,KADX,CAChBI,QADgB,cAChBA,QADgB,CACNC,QADM,cACNA,QADM,yBAElBA,CAAAA,QAAQ,CAACoB,OAAT,CAAiB6B,uBAAjB,GAA2Cf,IAA3C,CAAgD,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAAhD,CAFkB,QAGxB,MAAK0C,YAAL,GAHwB,0D,SAM1BS,kB,sEAAqB,6LACW,MAAKvD,KADhB,CACXI,QADW,cACXA,QADW,CACDC,QADC,cACDA,QADC,yBAEbA,CAAAA,QAAQ,CAACoB,OAAT,CAAiB8B,kBAAjB,GAAsChB,IAAtC,CAA2C,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAA3C,CAFa,QAGnB,MAAK0C,YAAL,GAHmB,0D,SAMrBU,gB,sEAAmB,6LACa,MAAKxD,KADlB,CACTI,QADS,cACTA,QADS,CACCC,QADD,cACCA,QADD,yBAEXA,CAAAA,QAAQ,CAACoB,OAAT,CAAiB+B,gBAAjB,GAAoCjB,IAApC,CAAyC,CAAEC,IAAI,CAAEpC,QAAQ,CAAC,CAAD,CAAhB,CAAzC,CAFW,QAGjB,MAAK0C,YAAL,GAHiB,0D,wEAMV,iBACP,GAAI,CAAC,KAAK9C,KAAL,CAAWG,IAAhB,CAAsB,CACpB,MAAO,0EAAP,CACD,CAED,GAAMsD,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpB3B,OAAO,CAACmB,GAAR,CAAY,UAAY,MAAI,CAACjD,KAAL,CAAWC,KAAnC,EACA6B,OAAO,CAACmB,GAAR,CAAY,aAAe,MAAI,CAACjD,KAAL,CAAWI,QAAX,CAAoB,CAApB,CAA3B,EACA,MAAO,CAAA,MAAI,CAACJ,KAAL,CAAWI,QAAX,CAAoB,CAApB,GAA0B,MAAI,CAACJ,KAAL,CAAWC,KAA5C,CACD,CAJD,CAMA,GAAIyD,CAAAA,iBAAJ,CACA,GAAIJ,CAAAA,uBAAJ,CACA,GAAIC,CAAAA,kBAAJ,CACA,GAAIC,CAAAA,gBAAJ,CACA,GAAIX,CAAAA,UAAJ,CAEA,GAAKY,OAAO,EAAZ,CAAiB,CACfC,iBAAiB,CACjB,+BACE,+BACE,kDADF,8BAE4B,6BAAO,IAAI,CAAC,MAAZ,CAAmB,EAAE,CAAC,aAAtB,EAF5B,CAGE,8BAAQ,OAAO,CAAE,KAAKxB,QAAtB,YAHF,CADF,CAME,8BANF,CAOE,+BAAK,8BAAQ,OAAO,CAAE,KAAKmB,yBAAtB,kDAAL,CAPF,CADA,CAUAC,uBAAuB,CAAG,+BAAK,8BAAQ,OAAO,CAAE,KAAKA,uBAAtB,iDAAL,CAA1B,CAEAC,kBAAkB,CAAG,+BAAK,8BAAQ,OAAO,CAAE,KAAKA,kBAAtB,oCAAL,CAArB,CAEAC,gBAAgB,CAAG,+BAAK,8BAAQ,OAAO,CAAE,KAAKA,gBAAtB,mCAAL,CAAnB,CAEAX,UAAU,CAAG,+BAAK,8BAAQ,OAAO,CAAE,KAAKA,UAAtB,6BAAL,CAAb,CACD,CAED,MACE,4BAAK,SAAS,CAAC,KAAf,EAEE,oDAFF,CAIE,yCAAa,KAAK7C,KAAL,CAAWI,QAAX,CAAoB,CAApB,CAAb,CAJF,CAME,kDAAsB,KAAKJ,KAAL,CAAWE,MAAjC,CANF,CAQEwD,iBARF,CAUE,+BACE,4DADF,yBAEuB,6BAAO,IAAI,CAAC,MAAZ,CAAmB,EAAE,CAAC,oBAAtB,EAFvB,CAGE,8BAAQ,OAAO,CAAE,KAAKjB,WAAtB,YAHF,CAVF,CAgBE,8BAhBF,CAiBGa,uBAjBH,CAkBE,8BAlBF,CAmBGC,kBAnBH,CAqBE,+BACE,sDADF,CAGE,KAAKvD,KAAL,CAAWM,SAAX,EAAwB,IAAxB,CAA+B,mDAA/B,CACE,8BACI,KAAKN,KAAL,CAAWM,SAAX,CAAqBqD,GAArB,CAA0B,SAACC,QAAD,CAAWC,KAAX,QAC1B,4BAAK,GAAG,CAAEA,KAAV,EACE,gCAAO,IAAMA,KAAN,CAAc,IAAd,CAAqBD,QAAQ,CAACE,YAAT,CAAsBC,mBAAlD,CADF,CAGE,6BAAO,KAAK,CAAEF,KAAd,CAAqB,IAAI,CAAC,UAA1B,EAHF,CAD0B,EAA1B,CADJ,CAJJ,CAcE,8BAAQ,OAAO,CAAE,KAAKlB,OAAtB,UAdF,CArBF,CAsCE,8BAtCF,CAuCGa,gBAvCH,CAyCE,+BAEA,8BAFA,CAGCX,UAHD,CAIA,8BAJA,CAKA,+BAAK,mDAAuB,KAAK7C,KAAL,CAAWO,MAAlC,CAAL,CALA,CAzCF,CAmDI,KAAKP,KAAL,CAAWM,SAAX,EAAwB,IAAxB,CAA+B,mDAA/B,CACE,8BACI,KAAKN,KAAL,CAAWM,SAAX,CAAqBqD,GAArB,CAA0B,SAACC,QAAD,QAAgB,+BAAKA,QAAQ,CAACE,YAAT,CAAsBC,mBAA3B,CAAhB,EAA1B,CADJ,CApDN,CADF,CA4DD,C,iBA/OenE,S,EAkPlB,cAAeG,CAAAA,GAAf","sourcesContent":["import React, { Component } from \"react\";\nimport VotingContract from \"./contracts/Voting.json\";\nimport getWeb3 from \"./getWeb3\";\n\nimport \"./App.css\";\n\nclass App extends Component {\n  state = { owner: null, status: 0, web3: null, accounts: null, contract: null, proposals: null, winner: null };\n\n\n  componentDidMount = async () => {\n    try {\n      // Get network provider and web3 instance.\n      const web3 = await getWeb3();\n\n      // Use web3 to get the user's accounts.\n      const accounts = await web3.eth.getAccounts();\n\n      // Get the contract instance.\n      const networkId = await web3.eth.net.getId();\n      const deployedNetwork = VotingContract.networks[networkId];\n      const instance = new web3.eth.Contract(\n        VotingContract.abi,\n        deployedNetwork && deployedNetwork.address,\n      );\n\n      // getting the events  \n      let options = {\n        fromBlock: 0,                  //Number || \"earliest\" || \"pending\" || \"latest\"\n        toBlock: 'latest'\n      };\n      const proposalsEvt = await instance.getPastEvents('ProposalRegistered', options);\n\n      const owner = await instance.methods.owner().call();\n\n      // Set web3, accounts, and contract to the state, and then proceed with an\n      // example of interacting with the contract's methods.\n      this.setState({ owner, web3, accounts, contract: instance, proposals: proposalsEvt }, this.runExample);\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\n        `Failed to load web3, accounts, or contract. Check console for details.`,\n      );\n      console.error(error);\n    }\n  };\n\n  runExample = async () => {\n    const { accounts, contract } = this.state;\n\n    const status = await contract.methods.workflowStatus().call();\n    // Update state with the result.\n    this.setState({ status: status });\n\n    if (this.state.status == 5) {\n      this.updateWinner();\n    }\n   \n    // getting the events  \n    let options = {\n      fromBlock: 0,                  //Number || \"earliest\" || \"pending\" || \"latest\"\n      toBlock: 'latest'\n    };\n    const proposalsEvt = await contract.getPastEvents('ProposalRegistered', options);\n\n    this.setState({ proposals:proposalsEvt });\n    \n  };\n\n  // Ajouter un Votant\n  addVoter = async () => {\n    const { accounts, contract} = this.state;\n    let voterAdress = document.getElementById(\"voterAdress\").value;\n    await contract.methods.addVoter(voterAdress).send({ from: accounts[0] });\n    document.getElementById(\"voterAdress\").value = \"\";\n  };\n\n  // Ajouter une propositions\n  addProposal = async () => {\n    const { accounts, contract} = this.state;\n    let proposalDescrition = document.getElementById(\"proposalDescrition\").value;\n    await contract.methods.addProposal(proposalDescrition).send({ from: accounts[0] });\n    document.getElementById(\"proposalDescrition\").value = \"\";\n  };\n\n  // Ajouter une propositions\n  setVote = async () => {\n      const { accounts, contract} = this.state;\n      //FIXME get the proposal checkedId\n      let proposalId = 1;\n      await contract.methods.setVote(proposalId).send({ from: accounts[0] });\n  };\n\n  // Comptabiliser les votes\n  tallyVotes = async () => {\n      const { accounts, contract} = this.state;\n      await contract.methods.tallyVotes().send({ from: accounts[0] });\n      this.updateStatus();\n      this.updateWinner();\n  };\n\n  updateStatus = async () => {\n    const { contract} = this.state;\n    const status = await contract.methods.workflowStatus().call();\n    // Update state with the result.\n    this.setState({ status: status });\n  }\n\n  updateWinner = async () => {\n    const {contract} = this.state;\n    \n      const winnerId = await contract.methods.winningProposalID().call();\n      console.log(winnerId);\n      try {\n        const winnerProposal = await contract.methods.getOneProposal(winnerId).call();\n        console.log(winnerProposal.description);\n        this.setState({ winner: '#' + winnerId + ' ' + winnerProposal.description });\n      } catch (error) {\n        this.setState({ winner: '' });\n      }\n    \n  }\n\n  // Démarrer l'enregistrement des propositions\n  startProposalsRegistering = async () => {\n    const { accounts, contract} = this.state;\n    await contract.methods.startProposalsRegistering().send({ from: accounts[0] });\n    this.updateStatus();\n  };\n  \n  endProposalsRegistering = async () => {\n    const { accounts, contract} = this.state;\n    await contract.methods.endProposalsRegistering().send({ from: accounts[0] });\n    this.updateStatus();\n  };\n\n  startVotingSession = async () => {\n    const { accounts, contract} = this.state;\n    await contract.methods.startVotingSession().send({ from: accounts[0] });\n    this.updateStatus();\n  };\n\n  endVotingSession = async () => {\n    const { accounts, contract} = this.state;\n    await contract.methods.endVotingSession().send({ from: accounts[0] });\n    this.updateStatus();\n  };\n\n  render() {\n    if (!this.state.web3) {\n      return <div>Loading Web3, accounts, and contract...</div>;\n    }\n\n    const isOwner = () => {\n      console.log('owner: ' + this.state.owner);\n      console.log('account0: ' + this.state.accounts[0]);\n      return this.state.accounts[0] == this.state.owner;\n    }\n\n    let voterRegistration;\n    let endProposalsRegistering;\n    let startVotingSession;\n    let endVotingSession;\n    let tallyVotes;\n\n    if ( isOwner() ) {\n      voterRegistration = \n      <div>\n        <div>\n          <h3>Ajouter un votant</h3>\n          Entrer l'adresse du votant<input type=\"text\" id=\"voterAdress\" />\n          <button onClick={this.addVoter}>Valider</button>\n        </div>\n        <br/>\n        <div><button onClick={this.startProposalsRegistering}> Démarrer l'enregitrement des Propositions</button></div> \n      </div>;\n      endProposalsRegistering = <div><button onClick={this.endProposalsRegistering}> Arrêter l'enregitrement des Propositions</button></div> ;\n\n      startVotingSession = <div><button onClick={this.startVotingSession}> Démarrer la session de vote</button></div> ;\n\n      endVotingSession = <div><button onClick={this.endVotingSession}> Arrêter la session de vote</button></div> ;\n\n      tallyVotes = <div><button onClick={this.tallyVotes}> Comptabiliser les votes</button></div> ;\n    } \n\n    return (\n      <div className=\"App\">\n        \n        <h2>Système de  Vote</h2>\n        \n        <p>adresse: {this.state.accounts[0]}</p>\n        \n        <div>WorkflowStatus: {this.state.status}</div>\n       \n       {voterRegistration}\n        \n        <div>\n          <h3>Enregistrer une Proposition</h3>\n          Entrer la Proposition<input type=\"text\" id=\"proposalDescrition\" />\n          <button onClick={this.addProposal}>Valider</button>\n        </div>\n\n        <br />\n        {endProposalsRegistering}\n        <br />\n        {startVotingSession}\n\n        <div>\n          <h3>Voter une proposition</h3>\n          {\n          this.state.proposals == null ? <p>Pas de propositions</p> : \n            <ul>\n              { this.state.proposals.map( (proposal, index) => (\n                <div key={index}>\n                  <span>{'#' + index + '  ' + proposal.returnValues.proposalDescription}</span>\n\n                  <input value={index} type=\"checkbox\" />\n                </div>\n               ) ) }\n            </ul>\n         }\n          <button onClick={this.setVote}>Voter</button>\n        </div>\n        \n        <br />\n        {endVotingSession}\n\n        <div>\n\n        <br />\n        {tallyVotes}\n        <br/>\n        <div><span>Le gagnant est: {this.state.winner}</span></div>\n        </div>\n  \n\n        {\n          this.state.proposals == null ? <p>Pas de propositions</p> : \n            <ul>\n              { this.state.proposals.map( (proposal) => ( <li>{proposal.returnValues.proposalDescription}</li> ) ) }\n            </ul>\n        }\n        \n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}